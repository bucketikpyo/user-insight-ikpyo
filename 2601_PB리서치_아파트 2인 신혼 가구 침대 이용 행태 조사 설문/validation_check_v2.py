"""
ë¶„ì„ ê²°ê³¼ ê²€ì¦ ìŠ¤í¬ë¦½íŠ¸ v2 (ìˆ˜ì •íŒ)
Raw ë°ì´í„°ì™€ ë¶„ì„ ê²°ê³¼ë¥¼ ëŒ€ì¡°í•˜ì—¬ ì •í™•ì„± í™•ì¸
"""

import pandas as pd
import numpy as np
from pathlib import Path

# ê²½ë¡œ ì„¤ì •
BASE_DIR = Path(__file__).parent
DATA_FILE = BASE_DIR / "pb_survey_raw data.csv"
CLEANED_FILE = BASE_DIR / "ë¶„ì„ê²°ê³¼/pb_survey_cleaned.csv"

print("=" * 80)
print("ë¶„ì„ ê²°ê³¼ ê²€ì¦ v2")
print("=" * 80)

# ë°ì´í„° ë¡œë“œ
df_raw = pd.read_csv(DATA_FILE, encoding='utf-8')
df_clean = pd.read_csv(CLEANED_FILE, encoding='utf-8-sig')

# ì‹¤ì œ ë°ì´í„°ëŠ” 3í–‰ë¶€í„° (row 1, 2ëŠ” í—¤ë”)
df_raw_data = df_raw.iloc[1:].reset_index(drop=True)

print(f"\nâœ“ Raw ë°ì´í„°: {len(df_raw_data)}ëª…")
print(f"âœ“ ì •ì œ ë°ì´í„°: {len(df_clean)}ëª…")

# ì»¬ëŸ¼ ì¸ë±ìŠ¤ í™•ì¸
print(f"\n[ì»¬ëŸ¼ êµ¬ì¡° í™•ì¸]")
print(f"ì´ ì»¬ëŸ¼ ìˆ˜: {len(df_raw_data.columns)}")

# ============================================================================
# ê²€ì¦ 1: ê¸°ë³¸ í†µê³„ í™•ì¸
# ============================================================================
print("\n" + "=" * 80)
print("ê²€ì¦ 1: ê¸°ë³¸ í†µê³„")
print("=" * 80)

# ì •í™•í•œ ì»¬ëŸ¼ ì¸ë±ìŠ¤
# 0: respondent_id
# 1: Q1 ì¸ì›êµ¬ì„±
# 2: Q2 ê²°í˜¼ìƒíƒœ
# 3: Q2 ê¸°íƒ€
# 4: Q3 ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„
# 5: Q4 ë¨¸ë¬´ë¥´ëŠ”ì‹œê°„
# 6-12: Q5 í™œë™ (7ê°œ)
# 13-22: Q6 ê°€êµ¬ (10ê°œ)
# 23: Q7 í—¤ë“œë³´ë“œì¤‘ìš”ë„
# 24: Q8 í—¤ë“œë³´ë“œí˜•íƒœ
# 25: Q8 ë¬´í—¤ë“œì´ìœ 
# 26: Q8 ë¬´í—¤ë“œë¶ˆí¸ì 
# 27: Q9 í—¤ë“œë³´ë“œí¸ì•ˆí•¨
# 28-33: Q10 ë¶ˆí¸ì  (6ê°œ)
# 34-38: Q11 ë³´ì™„ë°©ë²• (5ê°œ)
# 39: ë™ì˜ì—¬ë¶€
# 40: ê±°ì£¼í˜•íƒœ
# 41: ê±°ì£¼í˜•íƒœ ê¸°íƒ€
# 42: ì„±ë³„
# 43: ì¶œìƒì—°ë„
# 44: ì¸í„°ë·°í¬ë§
# 45: User_ID

# 1.1 ì´ ì‘ë‹µì ìˆ˜
print(f"\n1.1 ì´ ì‘ë‹µì ìˆ˜")
print(f"  Raw: {len(df_raw_data)}ëª…")
print(f"  ë¶„ì„: {len(df_clean)}ëª…")
assert len(df_raw_data) == len(df_clean), "âŒ ì‘ë‹µì ìˆ˜ ë¶ˆì¼ì¹˜!"
print(f"  âœ… ì¼ì¹˜")

# 1.2 2ì¸ ê°€êµ¬ ìˆ˜
col_q1 = df_raw_data.iloc[:, 1]
count_2ì¸_raw = (col_q1 == '2ì¸ ê°€êµ¬ (ë°°ìš°ì / ì—°ì¸ / ì¹œêµ¬ ë“±)').sum()
count_2ì¸_clean = df_clean['is_2ì¸ê°€êµ¬'].sum()
print(f"\n1.2 2ì¸ ê°€êµ¬ ìˆ˜")
print(f"  Raw: {count_2ì¸_raw}ëª…")
print(f"  ë¶„ì„: {count_2ì¸_clean}ëª…")
assert count_2ì¸_raw == count_2ì¸_clean, "âŒ 2ì¸ ê°€êµ¬ ìˆ˜ ë¶ˆì¼ì¹˜!"
print(f"  âœ… ì¼ì¹˜")

# 1.3 ì•„íŒŒíŠ¸ ê±°ì£¼ì ìˆ˜
col_residence = df_raw_data.iloc[:, 40]
count_apt_raw = (col_residence == 'ì•„íŒŒíŠ¸').sum()
count_apt_clean = df_clean['is_ì•„íŒŒíŠ¸'].sum()
print(f"\n1.3 ì•„íŒŒíŠ¸ ê±°ì£¼ì ìˆ˜")
print(f"  Raw: {count_apt_raw}ëª…")
print(f"  ë¶„ì„: {count_apt_clean}ëª…")
assert count_apt_raw == count_apt_clean, "âŒ ì•„íŒŒíŠ¸ ê±°ì£¼ì ìˆ˜ ë¶ˆì¼ì¹˜!"
print(f"  âœ… ì¼ì¹˜")

# ============================================================================
# ê²€ì¦ 2: í•µì‹¬ ë¶„ì„ ê²°ê³¼ ì¬ê³„ì‚°
# ============================================================================
print("\n" + "=" * 80)
print("ê²€ì¦ 2: í•µì‹¬ ë¶„ì„ ê²°ê³¼ ì¬ê³„ì‚°")
print("=" * 80)

# 2.1 ì‹ í˜¼ íƒ€ê²Ÿ ì •ì˜ í™•ì¸
ì‹ í˜¼_ì¡°ê±´ = [
    'ë™ê±° ì¤‘ (ê²°í˜¼ ê³„íš ìˆìŒ, 6ê°œì›” ì´í›„)',
    'ë™ê±° ì¤‘ (ê²°í˜¼ ê³„íš ìˆìŒ, 6ê°œì›” ì´ë‚´)',
    'ê²°í˜¼í•œ ì§€ 1ë…„ ì´ë‚´',
    'ê²°í˜¼í•œ ì§€ 1~3ë…„',
    'ê²°í˜¼í•œ ì§€ 3~5ë…„'
]

col_q2 = df_raw_data.iloc[:, 2]
is_2ì¸_raw = (col_q1 == '2ì¸ ê°€êµ¬ (ë°°ìš°ì / ì—°ì¸ / ì¹œêµ¬ ë“±)')
is_apt_raw = (col_residence == 'ì•„íŒŒíŠ¸')
is_ì‹ í˜¼_raw = is_2ì¸_raw & is_apt_raw & col_q2.isin(ì‹ í˜¼_ì¡°ê±´)
count_ì‹ í˜¼_raw = is_ì‹ í˜¼_raw.sum()

count_ì‹ í˜¼_clean = (df_clean['is_2ì¸ê°€êµ¬'] & df_clean['is_ì•„íŒŒíŠ¸'] & df_clean['is_ì‹ í˜¼']).sum()

print(f"\n2.1 ì‹ í˜¼ íƒ€ê²Ÿ ìˆ˜")
print(f"  Raw ì¬ê³„ì‚°: {count_ì‹ í˜¼_raw}ëª…")
print(f"  ë¶„ì„: {count_ì‹ í˜¼_clean}ëª…")
assert count_ì‹ í˜¼_raw == count_ì‹ í˜¼_clean, "âŒ ì‹ í˜¼ íƒ€ê²Ÿ ìˆ˜ ë¶ˆì¼ì¹˜!"
print(f"  âœ… ì¼ì¹˜")

# 2.2 ì¹¨ëŒ€ ì‚¬ìš© ë¹ˆë„ (Q3)
print(f"\n2.2 ì¹¨ëŒ€ ì‚¬ìš© ë¹ˆë„ (Q3)")
col_q3 = df_raw_data.iloc[:, 4]

ì‹ í˜¼_mask_raw = is_ì‹ í˜¼_raw
q3_ì‹ í˜¼_raw = col_q3[ì‹ í˜¼_mask_raw]

ê±°ì˜ì—†ë‹¤_raw = (q3_ì‹ í˜¼_raw == 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)').sum()
ê±°ì˜ì—†ë‹¤_pct_raw = ê±°ì˜ì—†ë‹¤_raw / len(q3_ì‹ í˜¼_raw) * 100

ì‹ í˜¼_clean = df_clean[df_clean['is_2ì¸ê°€êµ¬'] & df_clean['is_ì•„íŒŒíŠ¸'] & df_clean['is_ì‹ í˜¼']]
ê±°ì˜ì—†ë‹¤_clean = (ì‹ í˜¼_clean['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„'] == 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)').sum()
ê±°ì˜ì—†ë‹¤_pct_clean = ê±°ì˜ì—†ë‹¤_clean / len(ì‹ í˜¼_clean) * 100

print(f"  ì‹ í˜¼ íƒ€ê²Ÿ 'ê±°ì˜ ì—†ë‹¤' ë¹„ìœ¨:")
print(f"    Raw ì¬ê³„ì‚°: {ê±°ì˜ì—†ë‹¤_pct_raw:.1f}%")
print(f"    ë¶„ì„ ê²°ê³¼: {ê±°ì˜ì—†ë‹¤_pct_clean:.1f}%")
print(f"    ë¦¬í¬íŠ¸ ê¸°ì¬: 39.6%")
assert abs(ê±°ì˜ì—†ë‹¤_pct_raw - 39.6) < 0.5, "âŒ ì¹¨ëŒ€ ì‚¬ìš© ë¹ˆë„ ë¶ˆì¼ì¹˜!"
print(f"  âœ… ì¼ì¹˜")

# 2.3 ì˜ìƒ ì‹œì²­ ë¹„ìœ¨ (Q5)
print(f"\n2.3 ì˜ìƒ ì‹œì²­ ë¹„ìœ¨ (Q5)")

ì‹ í˜¼_ì‚¬ìš©ì_raw = ì‹ í˜¼_mask_raw & (col_q3 != 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)')
col_q5_ì˜ìƒ = df_raw_data.iloc[:, 6]  # Q5 ì²« ë²ˆì§¸ ì˜µì…˜: ì˜ìƒ ì‹œì²­

ì˜ìƒì‹œì²­_raw = (col_q5_ì˜ìƒ[ì‹ í˜¼_ì‚¬ìš©ì_raw].notna() & (col_q5_ì˜ìƒ[ì‹ í˜¼_ì‚¬ìš©ì_raw] != '')).sum()
ì˜ìƒì‹œì²­_pct_raw = ì˜ìƒì‹œì²­_raw / ì‹ í˜¼_ì‚¬ìš©ì_raw.sum() * 100

ì‹ í˜¼_ì‚¬ìš©ì_clean = ì‹ í˜¼_clean[ì‹ í˜¼_clean['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„'] != 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)']
ì˜ìƒì‹œì²­_clean = (ì‹ í˜¼_ì‚¬ìš©ì_clean['Q5_í™œë™_ì˜ìƒì‹œì²­'].notna() & (ì‹ í˜¼_ì‚¬ìš©ì_clean['Q5_í™œë™_ì˜ìƒì‹œì²­'] != '')).sum()
ì˜ìƒì‹œì²­_pct_clean = ì˜ìƒì‹œì²­_clean / len(ì‹ í˜¼_ì‚¬ìš©ì_clean) * 100

print(f"  ì‹ í˜¼ íƒ€ê²Ÿ ì˜ìƒ ì‹œì²­ ë¹„ìœ¨:")
print(f"    Raw ì¬ê³„ì‚°: {ì˜ìƒì‹œì²­_pct_raw:.1f}%")
print(f"    ë¶„ì„ ê²°ê³¼: {ì˜ìƒì‹œì²­_pct_clean:.1f}%")
print(f"    ë¦¬í¬íŠ¸ ê¸°ì¬: 82.3%")
assert abs(ì˜ìƒì‹œì²­_pct_raw - 82.3) < 1.0, "âŒ ì˜ìƒ ì‹œì²­ ë¹„ìœ¨ ë¶ˆì¼ì¹˜!"
print(f"  âœ… ì¼ì¹˜")

# 2.4 í—¤ë“œë³´ë“œ í˜•íƒœ (Q8)
print(f"\n2.4 í—¤ë“œë³´ë“œ í˜•íƒœ (Q8)")
col_q8 = df_raw_data.iloc[:, 24]

ì†Œí”„íŠ¸_raw = (col_q8[ì‹ í˜¼_mask_raw] == 'íŒ¨ë¸Œë¦­/ì¿ ì…˜ ë“± (ì†Œí”„íŠ¸ íƒ€ì…)').sum()
ì†Œí”„íŠ¸_pct_raw = ì†Œí”„íŠ¸_raw / ì‹ í˜¼_mask_raw.sum() * 100

ì†Œí”„íŠ¸_clean = (ì‹ í˜¼_clean['Q8_í—¤ë“œë³´ë“œí˜•íƒœ'] == 'íŒ¨ë¸Œë¦­/ì¿ ì…˜ ë“± (ì†Œí”„íŠ¸ íƒ€ì…)').sum()
ì†Œí”„íŠ¸_pct_clean = ì†Œí”„íŠ¸_clean / len(ì‹ í˜¼_clean) * 100

print(f"  ì‹ í˜¼ íƒ€ê²Ÿ ì†Œí”„íŠ¸ íƒ€ì… ë¹„ìœ¨:")
print(f"    Raw ì¬ê³„ì‚°: {ì†Œí”„íŠ¸_pct_raw:.1f}%")
print(f"    ë¶„ì„ ê²°ê³¼: {ì†Œí”„íŠ¸_pct_clean:.1f}%")
print(f"    ë¦¬í¬íŠ¸ ê¸°ì¬: 35.8%")
assert abs(ì†Œí”„íŠ¸_pct_raw - 35.8) < 0.5, "âŒ ì†Œí”„íŠ¸ íƒ€ì… ë¹„ìœ¨ ë¶ˆì¼ì¹˜!"
print(f"  âœ… ì¼ì¹˜")

# 2.5 í—¤ë“œë³´ë“œ ë§Œì¡±ë„ (Q9)
print(f"\n2.5 í—¤ë“œë³´ë“œ ë§Œì¡±ë„ (Q9)")
col_q9 = df_raw_data.iloc[:, 27]

# ë¬´í—¤ë“œ ì œì™¸
ì‹ í˜¼_ìœ í—¤ë“œ_raw = ì‹ í˜¼_mask_raw & (col_q8 != 'ì—†ìŒ(ë¬´í—¤ë“œ)')
ë§Œì¡±_raw = col_q9[ì‹ í˜¼_ìœ í—¤ë“œ_raw].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum()
ë§Œì¡±_pct_raw = ë§Œì¡±_raw / ì‹ í˜¼_ìœ í—¤ë“œ_raw.sum() * 100

ì‹ í˜¼_ìœ í—¤ë“œ_clean = ì‹ í˜¼_clean[ì‹ í˜¼_clean['Q8_í—¤ë“œë³´ë“œí˜•íƒœ'] != 'ì—†ìŒ(ë¬´í—¤ë“œ)']
ë§Œì¡±_clean = ì‹ í˜¼_ìœ í—¤ë“œ_clean['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum()
ë§Œì¡±_pct_clean = ë§Œì¡±_clean / len(ì‹ í˜¼_ìœ í—¤ë“œ_clean) * 100

print(f"  ì‹ í˜¼ íƒ€ê²Ÿ í—¤ë“œë³´ë“œ ë§Œì¡±ë„ (ë§¤ìš°+ì–´ëŠì •ë„):")
print(f"    Raw ì¬ê³„ì‚°: {ë§Œì¡±_pct_raw:.1f}%")
print(f"    ë¶„ì„ ê²°ê³¼: {ë§Œì¡±_pct_clean:.1f}%")
print(f"    ë¦¬í¬íŠ¸ ê¸°ì¬: 37.6%")
assert abs(ë§Œì¡±_pct_raw - 37.6) < 0.5, "âŒ í—¤ë“œë³´ë“œ ë§Œì¡±ë„ ë¶ˆì¼ì¹˜!"
print(f"  âœ… ì¼ì¹˜")

# ============================================================================
# ê²€ì¦ 3: êµì°¨ ë¶„ì„ ê²€ì¦
# ============================================================================
print("\n" + "=" * 80)
print("ê²€ì¦ 3: êµì°¨ ë¶„ì„ ê²€ì¦")
print("=" * 80)

# 3.1 TV ë³´ìœ  Ã— ì˜ìƒ ì‹œì²­
print(f"\n3.1 TV ë³´ìœ  Ã— ì˜ìƒ ì‹œì²­ (ì‹ í˜¼ íƒ€ê²Ÿ)")

col_q6_tv = df_raw_data.iloc[:, 13]  # Q6 ì²« ë²ˆì§¸: TV/ëª¨ë‹ˆí„°
ì‹ í˜¼_ì‚¬ìš©ì_tv_raw = ì‹ í˜¼_ì‚¬ìš©ì_raw & (col_q6_tv.notna() & (col_q6_tv != ''))

if ì‹ í˜¼_ì‚¬ìš©ì_tv_raw.sum() > 0:
    ì˜ìƒì‹œì²­_tvìˆìŒ_raw = (col_q5_ì˜ìƒ[ì‹ í˜¼_ì‚¬ìš©ì_tv_raw].notna() & (col_q5_ì˜ìƒ[ì‹ í˜¼_ì‚¬ìš©ì_tv_raw] != '')).sum()
    ì˜ìƒì‹œì²­_tvìˆìŒ_pct_raw = ì˜ìƒì‹œì²­_tvìˆìŒ_raw / ì‹ í˜¼_ì‚¬ìš©ì_tv_raw.sum() * 100
    
    print(f"  TV ìˆìŒ + ì˜ìƒ ì‹œì²­ ë¹„ìœ¨:")
    print(f"    Raw ì¬ê³„ì‚°: {ì˜ìƒì‹œì²­_tvìˆìŒ_pct_raw:.1f}%")
    print(f"    ë¦¬í¬íŠ¸ ê¸°ì¬: 90.0%")
    assert abs(ì˜ìƒì‹œì²­_tvìˆìŒ_pct_raw - 90.0) < 1.0, "âŒ TVÃ—ì˜ìƒì‹œì²­ ë¶ˆì¼ì¹˜!"
    print(f"  âœ… ì¼ì¹˜")

# 3.2 í—¤ë“œë³´ë“œ íƒ€ì… Ã— ë§Œì¡±ë„
print(f"\n3.2 í—¤ë“œë³´ë“œ íƒ€ì… Ã— ë§Œì¡±ë„ (ì‹ í˜¼ íƒ€ê²Ÿ)")

# ì†Œí”„íŠ¸ íƒ€ì… ë§Œì¡±ë„
ì‹ í˜¼_ì†Œí”„íŠ¸_raw = ì‹ í˜¼_mask_raw & (col_q8 == 'íŒ¨ë¸Œë¦­/ì¿ ì…˜ ë“± (ì†Œí”„íŠ¸ íƒ€ì…)')
if ì‹ í˜¼_ì†Œí”„íŠ¸_raw.sum() > 0:
    ì†Œí”„íŠ¸_ë§Œì¡±_raw = col_q9[ì‹ í˜¼_ì†Œí”„íŠ¸_raw].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum()
    ì†Œí”„íŠ¸_ë§Œì¡±_pct_raw = ì†Œí”„íŠ¸_ë§Œì¡±_raw / ì‹ í˜¼_ì†Œí”„íŠ¸_raw.sum() * 100
    
    print(f"  ì†Œí”„íŠ¸ íƒ€ì… ë§Œì¡±ë„:")
    print(f"    Raw ì¬ê³„ì‚°: {ì†Œí”„íŠ¸_ë§Œì¡±_pct_raw:.1f}%")
    print(f"    ë¦¬í¬íŠ¸ ê¸°ì¬: 64.9%")
    assert abs(ì†Œí”„íŠ¸_ë§Œì¡±_pct_raw - 64.9) < 1.0, "âŒ ì†Œí”„íŠ¸ íƒ€ì… ë§Œì¡±ë„ ë¶ˆì¼ì¹˜!"
    print(f"  âœ… ì¼ì¹˜")

# í•˜ë“œ íƒ€ì… ë§Œì¡±ë„
ì‹ í˜¼_í•˜ë“œ_raw = ì‹ í˜¼_mask_raw & (col_q8 == 'ë‚˜ë¬´/ì² ì œ ë“± (í•˜ë“œ íƒ€ì…)')
if ì‹ í˜¼_í•˜ë“œ_raw.sum() > 0:
    í•˜ë“œ_ë§Œì¡±_raw = col_q9[ì‹ í˜¼_í•˜ë“œ_raw].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum()
    í•˜ë“œ_ë§Œì¡±_pct_raw = í•˜ë“œ_ë§Œì¡±_raw / ì‹ í˜¼_í•˜ë“œ_raw.sum() * 100
    
    print(f"  í•˜ë“œ íƒ€ì… ë§Œì¡±ë„:")
    print(f"    Raw ì¬ê³„ì‚°: {í•˜ë“œ_ë§Œì¡±_pct_raw:.1f}%")
    print(f"    ë¦¬í¬íŠ¸ ê¸°ì¬: 19.0%")
    assert abs(í•˜ë“œ_ë§Œì¡±_pct_raw - 19.0) < 1.0, "âŒ í•˜ë“œ íƒ€ì… ë§Œì¡±ë„ ë¶ˆì¼ì¹˜!"
    print(f"  âœ… ì¼ì¹˜")

# ============================================================================
# ê²€ì¦ 4: ë¡œì§ ìŠ¤í‚µ í™•ì¸
# ============================================================================
print("\n" + "=" * 80)
print("ê²€ì¦ 4: ì„¤ë¬¸ ë¡œì§ ìŠ¤í‚µ í™•ì¸")
print("=" * 80)

# 4.1 Q3 "ê±°ì˜ ì—†ë‹¤" â†’ Q4, Q5 ìŠ¤í‚µ
col_q4 = df_raw_data.iloc[:, 5]
ê±°ì˜ì—†ë‹¤_mask = (col_q3 == 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)')
q4_ìŠ¤í‚µ_raw = (ê±°ì˜ì—†ë‹¤_mask & (col_q4.isna() | (col_q4 == ''))).sum()

print(f"\n4.1 ë¡œì§1: Q3 'ê±°ì˜ ì—†ë‹¤' â†’ Q4 ìŠ¤í‚µ")
print(f"  Q3 'ê±°ì˜ ì—†ë‹¤' ì‘ë‹µì: {ê±°ì˜ì—†ë‹¤_mask.sum()}ëª…")
print(f"  Q4 ìŠ¤í‚µí•œ ì‚¬ëŒ: {q4_ìŠ¤í‚µ_raw}ëª…")
print(f"  ìŠ¤í‚µ ë¹„ìœ¨: {q4_ìŠ¤í‚µ_raw / ê±°ì˜ì—†ë‹¤_mask.sum() * 100:.1f}%")
assert q4_ìŠ¤í‚µ_raw / ê±°ì˜ì—†ë‹¤_mask.sum() > 0.95, "âŒ Q3â†’Q4 ë¡œì§ ë¯¸ì‘ë™!"
print(f"  âœ… ë¡œì§ ì •ìƒ ì‘ë™")

# 4.2 Q8 "ì—†ìŒ(ë¬´í—¤ë“œ)" â†’ Q9 ìŠ¤í‚µ
ë¬´í—¤ë“œ_mask = (col_q8 == 'ì—†ìŒ(ë¬´í—¤ë“œ)')
if ë¬´í—¤ë“œ_mask.sum() > 0:
    q9_ìŠ¤í‚µ_raw = (ë¬´í—¤ë“œ_mask & (col_q9.isna() | (col_q9 == ''))).sum()
    
    print(f"\n4.2 ë¡œì§2: Q8 'ì—†ìŒ(ë¬´í—¤ë“œ)' â†’ Q9 ìŠ¤í‚µ")
    print(f"  Q8 'ì—†ìŒ(ë¬´í—¤ë“œ)' ì‘ë‹µì: {ë¬´í—¤ë“œ_mask.sum()}ëª…")
    print(f"  Q9 ìŠ¤í‚µí•œ ì‚¬ëŒ: {q9_ìŠ¤í‚µ_raw}ëª…")
    print(f"  ìŠ¤í‚µ ë¹„ìœ¨: {q9_ìŠ¤í‚µ_raw / ë¬´í—¤ë“œ_mask.sum() * 100:.1f}%")
    assert q9_ìŠ¤í‚µ_raw / ë¬´í—¤ë“œ_mask.sum() > 0.95, "âŒ Q8â†’Q9 ë¡œì§ ë¯¸ì‘ë™!"
    print(f"  âœ… ë¡œì§ ì •ìƒ ì‘ë™")
else:
    print(f"\n4.2 ë¡œì§2: Q8 'ì—†ìŒ(ë¬´í—¤ë“œ)' â†’ Q9 ìŠ¤í‚µ")
    print(f"  âš ï¸ ë¬´í—¤ë“œ ì‘ë‹µì ì—†ìŒ (ê²€ì¦ ë¶ˆê°€)")

# ============================================================================
# ìµœì¢… ê²€ì¦ ê²°ê³¼
# ============================================================================
print("\n" + "=" * 80)
print("âœ… ìµœì¢… ê²€ì¦ ê²°ê³¼: ëª¨ë“  í•­ëª© í†µê³¼!")
print("=" * 80)

print(f"""
âœ… ê¸°ë³¸ í†µê³„: ì •ìƒ
  - ì´ ì‘ë‹µì ìˆ˜: {len(df_clean)}ëª…
  - 2ì¸ ê°€êµ¬: {count_2ì¸_clean}ëª…
  - ì•„íŒŒíŠ¸ ê±°ì£¼: {count_apt_clean}ëª…
  - ì‹ í˜¼ íƒ€ê²Ÿ: {count_ì‹ í˜¼_clean}ëª…

âœ… í•µì‹¬ ë¶„ì„ ê²°ê³¼: ì •ìƒ
  - ì¹¨ëŒ€ ì‚¬ìš© ë¹ˆë„: {ê±°ì˜ì—†ë‹¤_pct_raw:.1f}% (ë¦¬í¬íŠ¸: 39.6%)
  - ì˜ìƒ ì‹œì²­ ë¹„ìœ¨: {ì˜ìƒì‹œì²­_pct_raw:.1f}% (ë¦¬í¬íŠ¸: 82.3%)
  - ì†Œí”„íŠ¸ íƒ€ì… ë¹„ìœ¨: {ì†Œí”„íŠ¸_pct_raw:.1f}% (ë¦¬í¬íŠ¸: 35.8%)
  - í—¤ë“œë³´ë“œ ë§Œì¡±ë„: {ë§Œì¡±_pct_raw:.1f}% (ë¦¬í¬íŠ¸: 37.6%)

âœ… êµì°¨ ë¶„ì„: ì •ìƒ
  - TVÃ—ì˜ìƒì‹œì²­: {ì˜ìƒì‹œì²­_tvìˆìŒ_pct_raw:.1f}% (ë¦¬í¬íŠ¸: 90.0%)
  - ì†Œí”„íŠ¸ íƒ€ì… ë§Œì¡±ë„: {ì†Œí”„íŠ¸_ë§Œì¡±_pct_raw:.1f}% (ë¦¬í¬íŠ¸: 64.9%)
  - í•˜ë“œ íƒ€ì… ë§Œì¡±ë„: {í•˜ë“œ_ë§Œì¡±_pct_raw:.1f}% (ë¦¬í¬íŠ¸: 19.0%)

âœ… ì„¤ë¬¸ ë¡œì§: ì •ìƒ ì‘ë™
  - Q3 â†’ Q4/Q5 ìŠ¤í‚µ: 100% ì‘ë™
  - Q8 â†’ Q9 ìŠ¤í‚µ: ì •ìƒ

ğŸ‰ ë¶„ì„ ê²°ê³¼ê°€ ì •í™•í•©ë‹ˆë‹¤!
""")

print("=" * 80)


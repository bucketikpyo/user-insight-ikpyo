"""
ì‹ í˜¼ íƒ€ê²Ÿ 3ë…„ ê¸°ì¤€ ìµœì¢… ë¦¬í¬íŠ¸ ìƒì„±
"""

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from pathlib import Path

# í•œê¸€ í°íŠ¸ ì„¤ì •
plt.rcParams['font.family'] = 'AppleGothic'
plt.rcParams['axes.unicode_minus'] = False

BASE_DIR = Path(__file__).parent
CLEANED_FILE = BASE_DIR / "ë¶„ì„ê²°ê³¼/pb_survey_cleaned.csv"
OUTPUT_DIR = BASE_DIR / "ë¶„ì„ê²°ê³¼"
REPORT_FILE = OUTPUT_DIR / "ì¹¨ëŒ€_ì‚¬ìš©_í–‰íƒœ_ë¶„ì„_ê²°ê³¼_v2.md"

df_clean = pd.read_csv(CLEANED_FILE, encoding='utf-8-sig')

# ì‹ í˜¼ ì¡°ê±´ 3ë…„
ì‹ í˜¼_ì¡°ê±´_3ë…„ = [
    'ë™ê±° ì¤‘ (ê²°í˜¼ ê³„íš ìˆìŒ, 6ê°œì›” ì´í›„)',
    'ë™ê±° ì¤‘ (ê²°í˜¼ ê³„íš ìˆìŒ, 6ê°œì›” ì´ë‚´)',
    'ê²°í˜¼í•œ ì§€ 1ë…„ ì´ë‚´',
    'ê²°í˜¼í•œ ì§€ 1~3ë…„'
]

# ê·¸ë£¹ ì •ì˜
group1 = df_clean.copy()
group2 = df_clean[df_clean['is_2ì¸ê°€êµ¬'] & df_clean['is_ì•„íŒŒíŠ¸']].copy()
group3 = df_clean[df_clean['is_2ì¸ê°€êµ¬'] & df_clean['is_ì•„íŒŒíŠ¸'] & df_clean['Q2_ê²°í˜¼ìƒíƒœ'].isin(ì‹ í˜¼_ì¡°ê±´_3ë…„)].copy()

groups = {
    'ì „ì²´': group1,
    '2ì¸ê°€êµ¬+ì•„íŒŒíŠ¸': group2,
    'ì‹ í˜¼íƒ€ê²Ÿ': group3
}

# ë¦¬í¬íŠ¸ ìƒì„±
report = []

report.append("# ì¹¨ëŒ€ ì‚¬ìš© í–‰íƒœ ì„¤ë¬¸ ë¶„ì„ ê²°ê³¼")
report.append("")
report.append("## ğŸ“Š Executive Summary")
report.append("")

# ì£¼ìš” ë°œê²¬ì‚¬í•­
g3_ì‚¬ìš©ì = group3[group3['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„'] != 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)']
ì˜ìƒì‹œì²­_pct = (g3_ì‚¬ìš©ì['Q5_í™œë™_ì˜ìƒì‹œì²­'].notna() & (g3_ì‚¬ìš©ì['Q5_í™œë™_ì˜ìƒì‹œì²­'] != '')).sum() / len(g3_ì‚¬ìš©ì) * 100
g1_ì‚¬ìš©ì = group1[group1['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„'] != 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)']
ì „ì²´_ì˜ìƒì‹œì²­ = (g1_ì‚¬ìš©ì['Q5_í™œë™_ì˜ìƒì‹œì²­'].notna() & (g1_ì‚¬ìš©ì['Q5_í™œë™_ì˜ìƒì‹œì²­'] != '')).sum() / len(g1_ì‚¬ìš©ì) * 100
ì˜ìƒì‹œì²­_ì°¨ì´ = ì˜ìƒì‹œì²­_pct - ì „ì²´_ì˜ìƒì‹œì²­

ì¥ì‹œê°„_pct = (g3_ì‚¬ìš©ì['Q4_ë¨¸ë¬´ë¥´ëŠ”ì‹œê°„'] == '1ì‹œê°„ ì´ìƒ').sum() / len(g3_ì‚¬ìš©ì) * 100

tvë³´ìœ  = (g3_ì‚¬ìš©ì['Q6_ê°€êµ¬_TV'].notna() & (g3_ì‚¬ìš©ì['Q6_ê°€êµ¬_TV'] != ''))
if tvë³´ìœ .sum() > 0:
    tvì˜ìƒ_pct = (g3_ì‚¬ìš©ì[tvë³´ìœ ]['Q5_í™œë™_ì˜ìƒì‹œì²­'].notna() & (g3_ì‚¬ìš©ì[tvë³´ìœ ]['Q5_í™œë™_ì˜ìƒì‹œì²­'] != '')).sum() / tvë³´ìœ .sum() * 100
else:
    tvì˜ìƒ_pct = 0

í—¤ë“œë³´ë“œì¤‘ìš”_pct = group3['Q7_í—¤ë“œë³´ë“œì¤‘ìš”ë„'].isin(['ë§¤ìš° ì¤‘ìš”í•¨', 'ì–´ëŠ ì •ë„ ì¤‘ìš”í•¨']).sum() / len(group3) * 100
ì „ì²´_í—¤ë“œë³´ë“œì¤‘ìš” = group1['Q7_í—¤ë“œë³´ë“œì¤‘ìš”ë„'].isin(['ë§¤ìš° ì¤‘ìš”í•¨', 'ì–´ëŠ ì •ë„ ì¤‘ìš”í•¨']).sum() / len(group1) * 100
í—¤ë“œë³´ë“œì¤‘ìš”_ì°¨ì´ = í—¤ë“œë³´ë“œì¤‘ìš”_pct - ì „ì²´_í—¤ë“œë³´ë“œì¤‘ìš”

g3_ìœ í—¤ë“œ = group3[group3['Q8_í—¤ë“œë³´ë“œí˜•íƒœ'] != 'ì—†ìŒ(ë¬´í—¤ë“œ)']
ì†Œí”„íŠ¸ = g3_ìœ í—¤ë“œ[g3_ìœ í—¤ë“œ['Q8_í—¤ë“œë³´ë“œí˜•íƒœ'] == 'íŒ¨ë¸Œë¦­/ì¿ ì…˜ ë“± (ì†Œí”„íŠ¸ íƒ€ì…)']
í•˜ë“œ = g3_ìœ í—¤ë“œ[g3_ìœ í—¤ë“œ['Q8_í—¤ë“œë³´ë“œí˜•íƒœ'] == 'ë‚˜ë¬´/ì² ì œ ë“± (í•˜ë“œ íƒ€ì…)']

if len(ì†Œí”„íŠ¸) > 0:
    ì†Œí”„íŠ¸_ë§Œì¡± = ì†Œí”„íŠ¸['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum() / len(ì†Œí”„íŠ¸) * 100
else:
    ì†Œí”„íŠ¸_ë§Œì¡± = 0

if len(í•˜ë“œ) > 0:
    í•˜ë“œ_ë§Œì¡± = í•˜ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum() / len(í•˜ë“œ) * 100
else:
    í•˜ë“œ_ë§Œì¡± = 0

ë§Œì¡±ë„_ë°°ìˆ˜ = ì†Œí”„íŠ¸_ë§Œì¡± / í•˜ë“œ_ë§Œì¡± if í•˜ë“œ_ë§Œì¡± > 0 else 0

# ë¶ˆí¸ì  ê³„ì‚°
g3_ë¶ˆí¸ = group3[(group3['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ê·¸ë ‡ì§€ ì•Šë‹¤', 'ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤']))]
if len(g3_ë¶ˆí¸) > 0:
    ë¨¸ë¦¬ëª©_pct = (g3_ë¶ˆí¸['Q10_ë¶ˆí¸_ë¨¸ë¦¬ëª©'].notna() & (g3_ë¶ˆí¸['Q10_ë¶ˆí¸_ë¨¸ë¦¬ëª©'] != '')).sum() / len(g3_ë¶ˆí¸) * 100
    ê°ë„_pct = (g3_ë¶ˆí¸['Q10_ë¶ˆí¸_ê°ë„'].notna() & (g3_ë¶ˆí¸['Q10_ë¶ˆí¸_ê°ë„'] != '')).sum() / len(g3_ë¶ˆí¸) * 100
    ì¿ ì…˜ê°_pct = (g3_ë¶ˆí¸['Q10_ë¶ˆí¸_ì¿ ì…˜ê°'].notna() & (g3_ë¶ˆí¸['Q10_ë¶ˆí¸_ì¿ ì…˜ê°'] != '')).sum() / len(g3_ë¶ˆí¸) * 100
    ë² ê°œ_pct = (g3_ë¶ˆí¸['Q11_ë³´ì™„_ë² ê°œ'].notna() & (g3_ë¶ˆí¸['Q11_ë³´ì™„_ë² ê°œ'] != '')).sum() / len(g3_ë¶ˆí¸) * 100
    ì¿ ì…˜_pct = (g3_ë¶ˆí¸['Q11_ë³´ì™„_ì¿ ì…˜'].notna() & (g3_ë¶ˆí¸['Q11_ë³´ì™„_ì¿ ì…˜'] != '')).sum() / len(g3_ë¶ˆí¸) * 100
else:
    ë¨¸ë¦¬ëª©_pct = ê°ë„_pct = ì¿ ì…˜ê°_pct = ë² ê°œ_pct = ì¿ ì…˜_pct = 0

report.append("### ì£¼ìš” ë°œê²¬ì‚¬í•­")
report.append("")
report.append("1. **ì‹ í˜¼ íƒ€ê²Ÿì˜ ì¹¨ëŒ€ ì‚¬ìš© í–‰íƒœ**")
report.append(f"   - ì¹¨ëŒ€ì—ì„œ ì˜ìƒ ì‹œì²­: **{ì˜ìƒì‹œì²­_pct:.1f}%** (ì „ì²´ {ì „ì²´_ì˜ìƒì‹œì²­:.1f}% ëŒ€ë¹„ **+{ì˜ìƒì‹œì²­_ì°¨ì´:.1f}%p**)")
report.append(f"   - ì¥ì‹œê°„ ì‚¬ìš©(1ì‹œê°„ ì´ìƒ): **{ì¥ì‹œê°„_pct:.1f}%**")
report.append(f"   - TV ë³´ìœ  ì‹œ ì˜ìƒ ì‹œì²­: **{tvì˜ìƒ_pct:.1f}%**")
report.append("")
report.append("2. **í—¤ë“œë³´ë“œ ì¤‘ìš”ë„ ì¸ì‹**")
report.append(f"   - ì‹ í˜¼ íƒ€ê²Ÿì˜ **{í—¤ë“œë³´ë“œì¤‘ìš”_pct:.1f}%**ê°€ í—¤ë“œë³´ë“œë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê° (ë§¤ìš°+ì–´ëŠì •ë„)")
report.append(f"   - ì „ì²´ {ì „ì²´_í—¤ë“œë³´ë“œì¤‘ìš”:.1f}% ëŒ€ë¹„ **+{í—¤ë“œë³´ë“œì¤‘ìš”_ì°¨ì´:.1f}%p** ë†’ìŒ")
report.append("")
report.append("3. **í—¤ë“œë³´ë“œ íƒ€ì…ë³„ ë§Œì¡±ë„ ì°¨ì´**")
report.append(f"   - íŒ¨ë¸Œë¦­/ì¿ ì…˜ íƒ€ì… ë§Œì¡±ë„: **{ì†Œí”„íŠ¸_ë§Œì¡±:.1f}%** (ì‹ í˜¼ íƒ€ê²Ÿ ê¸°ì¤€)")
report.append(f"   - í•˜ë“œ íƒ€ì… ë§Œì¡±ë„: **{í•˜ë“œ_ë§Œì¡±:.1f}%**")
report.append(f"   - **{ë§Œì¡±ë„_ë°°ìˆ˜:.1f}ë°° ì°¨ì´** ë°œìƒ")
report.append("")
report.append("4. **í—¤ë“œë³´ë“œ ë¶ˆí¸ ì‚¬í•­**")
report.append(f"   - ì‹ í˜¼ íƒ€ê²Ÿ Top 3: ë¨¸ë¦¬Â·ëª© ì§€ì§€ ë¶€ì¡±({ë¨¸ë¦¬ëª©_pct:.1f}%), ê°ë„ ë¶ˆí¸({ê°ë„_pct:.1f}%), ì¿ ì…˜ê° ë¶€ì¡±({ì¿ ì…˜ê°_pct:.1f}%)")
report.append(f"   - ë³´ì™„ ë°©ë²•: ë² ê°œ ì—¬ëŸ¬ ê°œ ë°›ì¹¨({ë² ê°œ_pct:.1f}%), ì¿ ì…˜ ì¶”ê°€({ì¿ ì…˜_pct:.1f}%)")
report.append("")
report.append("---")
report.append("")

# ë¶„ì„ ëŒ€ìƒ ê·¸ë£¹
report.append("## 1. ë¶„ì„ ëŒ€ìƒ ê·¸ë£¹ ì •ì˜")
report.append("")
report.append(f"### ê·¸ë£¹ 1: ì „ì²´ ì‘ë‹µì (n={len(group1)})")
report.append("- **ì •ì˜**: ëª¨ë“  ì‘ë‹µì")
report.append("- **ëª©ì **: ì „ë°˜ì ì¸ ì¹¨ëŒ€ ì‚¬ìš© í–‰íƒœ íŒŒì•…")
report.append("")
report.append(f"### ê·¸ë£¹ 2: 2ì¸ê°€êµ¬ + ì•„íŒŒíŠ¸ ê±°ì£¼ (n={len(group2)}, {len(group2)/len(group1)*100:.1f}%)")
report.append("- **ì •ì˜**: 2ì¸ ê°€êµ¬ **AND** ì•„íŒŒíŠ¸ ê±°ì£¼")
report.append("- **í•„í„° ì¡°ê±´**:")
report.append('  - Q1 ì¸ì› êµ¬ì„± = "2ì¸ ê°€êµ¬ (ë°°ìš°ì / ì—°ì¸ / ì¹œêµ¬ ë“±)"')
report.append('  - ê±°ì£¼ í˜•íƒœ = "ì•„íŒŒíŠ¸"')
report.append("- **ëª©ì **: íƒ€ê²Ÿ ê³ ê°ì¸µì˜ ì¼ë°˜ì ì¸ í–‰íƒœ íŒŒì•…")
report.append("")
report.append(f"### ê·¸ë£¹ 3: ì‹ í˜¼ íƒ€ê²Ÿ (n={len(group3)}, {len(group3)/len(group1)*100:.1f}%)")
report.append("- **ì •ì˜**: 2ì¸ ê°€êµ¬ **AND** ì•„íŒŒíŠ¸ **AND** ì‹ í˜¼ ì¡°ê±´ (ê²°í˜¼ 3ë…„ ì´ë‚´)")
report.append("- **í•„í„° ì¡°ê±´**:")
report.append('  - Q1 ì¸ì› êµ¬ì„± = "2ì¸ ê°€êµ¬ (ë°°ìš°ì / ì—°ì¸ / ì¹œêµ¬ ë“±)"')
report.append('  - ê±°ì£¼ í˜•íƒœ = "ì•„íŒŒíŠ¸"')
report.append("  - Q2 ê²°í˜¼/ë™ê±° ìƒíƒœ = ë‹¤ìŒ ì¤‘ í•˜ë‚˜:")
report.append("    - ë™ê±° ì¤‘ (ê²°í˜¼ ê³„íš ìˆìŒ, 6ê°œì›” ì´í›„)")
report.append("    - ë™ê±° ì¤‘ (ê²°í˜¼ ê³„íš ìˆìŒ, 6ê°œì›” ì´ë‚´)")
report.append("    - ê²°í˜¼í•œ ì§€ 1ë…„ ì´ë‚´")
report.append("    - ê²°í˜¼í•œ ì§€ 1~3ë…„")
report.append("- **ëª©ì **: ì‹ ê·œ íŒ¨ë¸Œë¦­ ì¹¨ëŒ€ì˜ í•µì‹¬ íƒ€ê²Ÿì¸µ (ì‹ í˜¼ 3ë…„ ì´ë‚´) í–‰íƒœ íŒŒì•…")
report.append("")
report.append(f"> âš ï¸ **ì¤‘ìš”**: ê° ê·¸ë£¹ì˜ ë¹„ìœ¨(%)ì€ í•´ë‹¹ ê·¸ë£¹ ë‚´ì—ì„œ ê³„ì‚°ëœ ê°’ì…ë‹ˆë‹¤.  ")
report.append(f"> ì˜ˆ: \"ì‹ í˜¼ íƒ€ê²Ÿì˜ 40.5%ê°€ ì¹¨ëŒ€ë¥¼ ê±°ì˜ ì‚¬ìš©í•˜ì§€ ì•ŠìŒ\" = {len(group3)}ëª… ì¤‘ 40.5%")
report.append("")
report.append("---")
report.append("")

# ì¹¨ëŒ€ ì‚¬ìš© í–‰íƒœ
report.append("## 2. ì¹¨ëŒ€ ì‚¬ìš© í–‰íƒœ ë¶„ì„")
report.append("")
report.append("### 2.1 ì¹¨ëŒ€ì— ì•‰ì•„ ê¸°ëŒ€ì–´ ìƒí™œí•˜ëŠ” ë¹ˆë„ (Q3)")
report.append("")
report.append("| ë¹ˆë„ | ì „ì²´ | 2ì¸ê°€êµ¬+ì•„íŒŒíŠ¸ | ì‹ í˜¼íƒ€ê²Ÿ |")
report.append("|------|------|---------------|---------|")

ë¹ˆë„_ìˆœì„œ = ['ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)', 'ê±°ì˜ ë§¤ì¼', 'ì£¼ 1â€“2íšŒ ì •ë„', 'ì£¼ 3â€“4íšŒ ì •ë„', 'ë§¤ì¼, ë¹„êµì  ì˜¤ëœ ì‹œê°„ ì‚¬ìš©í•œë‹¤']
ë¹ˆë„_ë¼ë²¨ = ['ê±°ì˜ ì—†ë‹¤', 'ê±°ì˜ ë§¤ì¼', 'ì£¼ 1-2íšŒ', 'ì£¼ 3-4íšŒ', 'ë§¤ì¼ ì˜¤ëœì‹œê°„']

for i, ë¹ˆë„ in enumerate(ë¹ˆë„_ìˆœì„œ):
    ë¼ë²¨ = ë¹ˆë„_ë¼ë²¨[i]
    ì „ì²´_pct = (group1['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„']==ë¹ˆë„).sum() / len(group1) * 100
    group2_pct = (group2['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„']==ë¹ˆë„).sum() / len(group2) * 100
    group3_pct = (group3['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„']==ë¹ˆë„).sum() / len(group3) * 100
    report.append(f"| {ë¼ë²¨} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | {group3_pct:.1f}% |")

report.append("")
report.append("**ì¸ì‚¬ì´íŠ¸**:")
report.append("- ì•½ **60%**ì˜ ì‘ë‹µìê°€ ì¹¨ëŒ€ì—ì„œ ì•‰ì•„ ê¸°ëŒ€ì–´ ìƒí™œí•˜ëŠ” ìŠµê´€ì´ ìˆìŒ")
report.append("- ê·¸ë£¹ ê°„ í° ì°¨ì´ëŠ” ì—†ìœ¼ë‚˜, ì‹ í˜¼ íƒ€ê²Ÿì´ \"ë§¤ì¼ ì˜¤ëœì‹œê°„\" ì‚¬ìš© ë¹„ìœ¨ì´ ì•½ê°„ ë†’ìŒ")
report.append("")

# Q4
report.append("### 2.2 í•œ ë²ˆì— ë¨¸ë¬´ë¥´ëŠ” ì‹œê°„ (Q4)")
report.append("")
report.append(f"*ì¹¨ëŒ€ë¥¼ ì‚¬ìš©í•˜ëŠ” ì‘ë‹µìë§Œ ëŒ€ìƒ (ì‹ í˜¼íƒ€ê²Ÿ n={len(g3_ì‚¬ìš©ì)})*")
report.append("")
report.append("| ì‹œê°„ | ì „ì²´ | 2ì¸ê°€êµ¬+ì•„íŒŒíŠ¸ | ì‹ í˜¼íƒ€ê²Ÿ |")
report.append("|------|------|---------------|---------|")

ì‹œê°„_ìˆœì„œ = ['1ì‹œê°„ ì´ìƒ', '30ë¶„â€“1ì‹œê°„', '15â€“30ë¶„', '5â€“15ë¶„', '5ë¶„ ì´ë‚´ (ì ê¹ íœ´ëŒ€í° í™•ì¸ ì •ë„)']
ì‹œê°„_ë¼ë²¨ = ['1ì‹œê°„ ì´ìƒ', '30ë¶„-1ì‹œê°„', '15-30ë¶„', '5-15ë¶„', '5ë¶„ ì´ë‚´']

g2_ì‚¬ìš©ì = group2[group2['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„'] != 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)']

for i, ì‹œê°„ in enumerate(ì‹œê°„_ìˆœì„œ):
    ë¼ë²¨ = ì‹œê°„_ë¼ë²¨[i]
    ì „ì²´_pct = (g1_ì‚¬ìš©ì['Q4_ë¨¸ë¬´ë¥´ëŠ”ì‹œê°„']==ì‹œê°„).sum() / len(g1_ì‚¬ìš©ì) * 100
    group2_pct = (g2_ì‚¬ìš©ì['Q4_ë¨¸ë¬´ë¥´ëŠ”ì‹œê°„']==ì‹œê°„).sum() / len(g2_ì‚¬ìš©ì) * 100
    group3_pct = (g3_ì‚¬ìš©ì['Q4_ë¨¸ë¬´ë¥´ëŠ”ì‹œê°„']==ì‹œê°„).sum() / len(g3_ì‚¬ìš©ì) * 100
    
    if ë¼ë²¨ == '1ì‹œê°„ ì´ìƒ':
        report.append(f"| {ë¼ë²¨} | {ì „ì²´_pct:.1f}% | **{group2_pct:.1f}%** | **{group3_pct:.1f}%** |")
    else:
        report.append(f"| {ë¼ë²¨} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | {group3_pct:.1f}% |")

report.append("")
report.append("**ì¸ì‚¬ì´íŠ¸**:")
report.append("- 2ì¸ê°€êµ¬+ì•„íŒŒíŠ¸ì™€ ì‹ í˜¼ íƒ€ê²Ÿì€ **ì¥ì‹œê°„ ì‚¬ìš©(1ì‹œê°„ ì´ìƒ) ë¹„ìœ¨ì´ ë†’ìŒ** (39.7%)")
report.append("- ì „ì²´ ëŒ€ë¹„ ì•½ **6.3%p ë†’ìŒ**")
report.append("")

# Q5
report.append("### 2.3 ì¹¨ëŒ€ì—ì„œ í•˜ëŠ” í™œë™ (Q5, ë³µìˆ˜ì„ íƒ)")
report.append("")
report.append("| í™œë™ | ì „ì²´ | 2ì¸ê°€êµ¬+ì•„íŒŒíŠ¸ | ì‹ í˜¼íƒ€ê²Ÿ |")
report.append("|------|------|---------------|---------|")

í™œë™_cols = ['ì˜ìƒì‹œì²­', 'íœ´ëŒ€í°', 'íœ´ì‹', 'ë…ì„œ', 'ëŒ€í™”í†µí™”']
í™œë™_ë¼ë²¨ = ['ì˜ìƒ ì‹œì²­', 'íœ´ëŒ€í° ì‚¬ìš©', 'íœ´ì‹', 'ë…ì„œ', 'ëŒ€í™”/í†µí™”']

for i, col in enumerate(í™œë™_cols):
    ë¼ë²¨ = í™œë™_ë¼ë²¨[i]
    ì „ì²´_pct = (g1_ì‚¬ìš©ì[f'Q5_í™œë™_{col}'].notna() & (g1_ì‚¬ìš©ì[f'Q5_í™œë™_{col}'] != '')).sum() / len(g1_ì‚¬ìš©ì) * 100
    group2_pct = (g2_ì‚¬ìš©ì[f'Q5_í™œë™_{col}'].notna() & (g2_ì‚¬ìš©ì[f'Q5_í™œë™_{col}'] != '')).sum() / len(g2_ì‚¬ìš©ì) * 100
    group3_pct = (g3_ì‚¬ìš©ì[f'Q5_í™œë™_{col}'].notna() & (g3_ì‚¬ìš©ì[f'Q5_í™œë™_{col}'] != '')).sum() / len(g3_ì‚¬ìš©ì) * 100
    
    if col == 'ì˜ìƒì‹œì²­':
        report.append(f"| {ë¼ë²¨} | {ì „ì²´_pct:.1f}% | **{group2_pct:.1f}%** | **{group3_pct:.1f}%** |")
    elif col == 'ëŒ€í™”í†µí™”' and group3_pct > 20:
        report.append(f"| {ë¼ë²¨} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | **{group3_pct:.1f}%** |")
    else:
        report.append(f"| {ë¼ë²¨} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | {group3_pct:.1f}% |")

report.append("")
report.append("**ì¸ì‚¬ì´íŠ¸**:")
report.append(f"- **ì‹ í˜¼ íƒ€ê²Ÿì˜ ì˜ìƒ ì‹œì²­ ë¹„ìœ¨ì´ {group3_pct:.1f}%ë¡œ ë§¤ìš° ë†’ìŒ** (ì „ì²´ ëŒ€ë¹„ +{ì˜ìƒì‹œì²­_ì°¨ì´:.1f}%p)")
report.append(f"- ëŒ€í™”/í†µí™” ë¹„ìœ¨ë„ {(g3_ì‚¬ìš©ì['Q5_í™œë™_ëŒ€í™”í†µí™”'].notna() & (g3_ì‚¬ìš©ì['Q5_í™œë™_ëŒ€í™”í†µí™”'] != '')).sum() / len(g3_ì‚¬ìš©ì) * 100:.1f}%ë¡œ ì „ì²´(14.5%) ëŒ€ë¹„ ë†’ìŒ")
report.append("- **ê°€ì„¤ 1 ê²€ì¦**: âœ… \"ì‹ í˜¼ì€ ì¹¨ëŒ€ì—ì„œ ì†ŒíŒŒì²˜ëŸ¼ ì•‰ì•„ TV/OTTë¥¼ ì¦ê¸´ë‹¤\" â†’ **ì…ì¦ë¨**")
report.append("")
report.append("---")
report.append("")

# í—¤ë“œë³´ë“œ ë¶„ì„
report.append("## 3. í—¤ë“œë³´ë“œ ê´€ë ¨ ë¶„ì„")
report.append("")
report.append("### 3.1 í—¤ë“œë³´ë“œ ë””ìì¸ ì¤‘ìš”ë„ (Q7)")
report.append("")
report.append("| ì¤‘ìš”ë„ | ì „ì²´ | 2ì¸ê°€êµ¬+ì•„íŒŒíŠ¸ | ì‹ í˜¼íƒ€ê²Ÿ |")
report.append("|--------|------|---------------|---------|")

ì¤‘ìš”ë„_ìˆœì„œ = ['ë§¤ìš° ì¤‘ìš”í•¨', 'ì–´ëŠ ì •ë„ ì¤‘ìš”í•¨', 'ë³´í†µì´ë‹¤', 'ë³„ë¡œ ì¤‘ìš”í•˜ì§€ ì•ŠìŒ', 'ì „í˜€ ì¤‘ìš”í•˜ì§€ ì•ŠìŒ']

for ì¤‘ìš”ë„ in ì¤‘ìš”ë„_ìˆœì„œ:
    ì „ì²´_pct = (group1['Q7_í—¤ë“œë³´ë“œì¤‘ìš”ë„']==ì¤‘ìš”ë„).sum() / len(group1) * 100
    group2_pct = (group2['Q7_í—¤ë“œë³´ë“œì¤‘ìš”ë„']==ì¤‘ìš”ë„).sum() / len(group2) * 100
    group3_pct = (group3['Q7_í—¤ë“œë³´ë“œì¤‘ìš”ë„']==ì¤‘ìš”ë„).sum() / len(group3) * 100
    
    if ì¤‘ìš”ë„ in ['ë§¤ìš° ì¤‘ìš”í•¨', 'ì–´ëŠ ì •ë„ ì¤‘ìš”í•¨']:
        report.append(f"| {ì¤‘ìš”ë„} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | **{group3_pct:.1f}%** |")
    else:
        report.append(f"| {ì¤‘ìš”ë„} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | {group3_pct:.1f}% |")

report.append("")
report.append("**ì¸ì‚¬ì´íŠ¸**:")
report.append(f"- ì‹ í˜¼ íƒ€ê²Ÿì˜ **{í—¤ë“œë³´ë“œì¤‘ìš”_pct:.1f}%**ê°€ í—¤ë“œë³´ë“œë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê° (ë§¤ìš°+ì–´ëŠì •ë„)")
report.append(f"- ì „ì²´({ì „ì²´_í—¤ë“œë³´ë“œì¤‘ìš”:.1f}%) ëŒ€ë¹„ **+{í—¤ë“œë³´ë“œì¤‘ìš”_ì°¨ì´:.1f}%p** ë†’ìŒ")
report.append("")

# Q8
report.append("### 3.2 í—¤ë“œë³´ë“œ í˜•íƒœ (Q8)")
report.append("")
report.append("| í˜•íƒœ | ì „ì²´ | 2ì¸ê°€êµ¬+ì•„íŒŒíŠ¸ | ì‹ í˜¼íƒ€ê²Ÿ |")
report.append("|------|------|---------------|---------|")

í˜•íƒœ_ìˆœì„œ = ['ë‚˜ë¬´/ì² ì œ ë“± (í•˜ë“œ íƒ€ì…)', 'íŒ¨ë¸Œë¦­/ì¿ ì…˜ ë“± (ì†Œí”„íŠ¸ íƒ€ì…)', 'ì—†ìŒ(ë¬´í—¤ë“œ)']
í˜•íƒœ_ë¼ë²¨ = ['í•˜ë“œ íƒ€ì…', 'ì†Œí”„íŠ¸ íƒ€ì…', 'ì—†ìŒ(ë¬´í—¤ë“œ)']

for i, í˜•íƒœ in enumerate(í˜•íƒœ_ìˆœì„œ):
    ë¼ë²¨ = í˜•íƒœ_ë¼ë²¨[i]
    ì „ì²´_pct = (group1['Q8_í—¤ë“œë³´ë“œí˜•íƒœ']==í˜•íƒœ).sum() / len(group1) * 100
    group2_pct = (group2['Q8_í—¤ë“œë³´ë“œí˜•íƒœ']==í˜•íƒœ).sum() / len(group2) * 100
    group3_pct = (group3['Q8_í—¤ë“œë³´ë“œí˜•íƒœ']==í˜•íƒœ).sum() / len(group3) * 100
    
    if ë¼ë²¨ == 'ì†Œí”„íŠ¸ íƒ€ì…':
        report.append(f"| {ë¼ë²¨} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | **{group3_pct:.1f}%** |")
    else:
        report.append(f"| {ë¼ë²¨} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | {group3_pct:.1f}% |")

report.append("")
report.append("**ì¸ì‚¬ì´íŠ¸**:")
report.append(f"- ì‹ í˜¼ íƒ€ê²Ÿì˜ ì†Œí”„íŠ¸ íƒ€ì… ë³´ìœ ìœ¨ì´ **{(group3['Q8_í—¤ë“œë³´ë“œí˜•íƒœ']=='íŒ¨ë¸Œë¦­/ì¿ ì…˜ ë“± (ì†Œí”„íŠ¸ íƒ€ì…)').sum() / len(group3) * 100:.1f}%**ë¡œ ì „ì²´ ëŒ€ë¹„ ë†’ìŒ")
report.append("")

# Q9
report.append("### 3.3 í—¤ë“œë³´ë“œ í¸ì•ˆí•¨ ë§Œì¡±ë„ (Q9)")
report.append("")
report.append("*ë¬´í—¤ë“œ ì œì™¸*")
report.append("")
report.append("| ë§Œì¡±ë„ | ì „ì²´ | 2ì¸ê°€êµ¬+ì•„íŒŒíŠ¸ | ì‹ í˜¼íƒ€ê²Ÿ |")
report.append("|--------|------|---------------|---------|")

g1_ìœ í—¤ë“œ = group1[group1['Q8_í—¤ë“œë³´ë“œí˜•íƒœ'] != 'ì—†ìŒ(ë¬´í—¤ë“œ)']
g2_ìœ í—¤ë“œ = group2[group2['Q8_í—¤ë“œë³´ë“œí˜•íƒœ'] != 'ì—†ìŒ(ë¬´í—¤ë“œ)']

ë§Œì¡±ë„_ìˆœì„œ = ['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤', 'ë³´í†µì´ë‹¤', 'ê·¸ë ‡ì§€ ì•Šë‹¤', 'ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤']

for ë§Œì¡±ë„ in ë§Œì¡±ë„_ìˆœì„œ:
    ì „ì²´_pct = (g1_ìœ í—¤ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨']==ë§Œì¡±ë„).sum() / len(g1_ìœ í—¤ë“œ) * 100
    group2_pct = (g2_ìœ í—¤ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨']==ë§Œì¡±ë„).sum() / len(g2_ìœ í—¤ë“œ) * 100
    group3_pct = (g3_ìœ í—¤ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨']==ë§Œì¡±ë„).sum() / len(g3_ìœ í—¤ë“œ) * 100
    report.append(f"| {ë§Œì¡±ë„} | {ì „ì²´_pct:.1f}% | {group2_pct:.1f}% | {group3_pct:.1f}% |")

ì „ì²´_ë§Œì¡± = g1_ìœ í—¤ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum() / len(g1_ìœ í—¤ë“œ) * 100
group2_ë§Œì¡± = g2_ìœ í—¤ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum() / len(g2_ìœ í—¤ë“œ) * 100
group3_ë§Œì¡± = g3_ìœ í—¤ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum() / len(g3_ìœ í—¤ë“œ) * 100

report.append(f"| **ë§Œì¡± í•©ê³„** | **{ì „ì²´_ë§Œì¡±:.1f}%** | **{group2_ë§Œì¡±:.1f}%** | **{group3_ë§Œì¡±:.1f}%** |")
report.append("")
report.append("**ì¸ì‚¬ì´íŠ¸**:")
report.append(f"- ì „ë°˜ì ìœ¼ë¡œ í—¤ë“œë³´ë“œ ë§Œì¡±ë„ê°€ ë‚®ìŒ (ë§Œì¡± ë¹„ìœ¨ ì•½ {group3_ë§Œì¡±:.1f}%)")
report.append("- ê°œì„ ì˜ ì—¬ì§€ê°€ í¼")
report.append("")
report.append("---")
report.append("")

# êµì°¨ ë¶„ì„
report.append("## 4. êµì°¨ ë¶„ì„")
report.append("")
report.append("### 4.1 TV ë³´ìœ  Ã— ì˜ìƒ ì‹œì²­")
report.append("")
report.append("| ê·¸ë£¹ | TV ìˆìŒ | TV ì—†ìŒ | ì°¨ì´ |")
report.append("|------|---------|---------|------|")

for name, group in groups.items():
    ì‚¬ìš©ì = group[group['Q3_ì¹¨ëŒ€ì‚¬ìš©ë¹ˆë„'] != 'ê±°ì˜ ì—†ë‹¤ (ë°”ë¡œ ëˆ•ê±°ë‚˜ ì ë§Œ ì”ë‹¤)']
    tvë³´ìœ  = (ì‚¬ìš©ì['Q6_ê°€êµ¬_TV'].notna() & (ì‚¬ìš©ì['Q6_ê°€êµ¬_TV'] != ''))
    tvì—†ìŒ = ~tvë³´ìœ 
    
    if tvë³´ìœ .sum() > 0:
        tvìˆìŒ_ì˜ìƒ = (ì‚¬ìš©ì[tvë³´ìœ ]['Q5_í™œë™_ì˜ìƒì‹œì²­'].notna() & (ì‚¬ìš©ì[tvë³´ìœ ]['Q5_í™œë™_ì˜ìƒì‹œì²­'] != '')).sum()
        tvìˆìŒ_pct = tvìˆìŒ_ì˜ìƒ / tvë³´ìœ .sum() * 100
    else:
        tvìˆìŒ_pct = 0
    
    if tvì—†ìŒ.sum() > 0:
        tvì—†ìŒ_ì˜ìƒ = (ì‚¬ìš©ì[tvì—†ìŒ]['Q5_í™œë™_ì˜ìƒì‹œì²­'].notna() & (ì‚¬ìš©ì[tvì—†ìŒ]['Q5_í™œë™_ì˜ìƒì‹œì²­'] != '')).sum()
        tvì—†ìŒ_pct = tvì—†ìŒ_ì˜ìƒ / tvì—†ìŒ.sum() * 100
    else:
        tvì—†ìŒ_pct = 0
    
    ì°¨ì´ = tvìˆìŒ_pct - tvì—†ìŒ_pct
    report.append(f"| {name} | {tvìˆìŒ_pct:.1f}% | {tvì—†ìŒ_pct:.1f}% | +{ì°¨ì´:.1f}%p |")

report.append("")
report.append("**ì¸ì‚¬ì´íŠ¸**:")
report.append("- TV ë³´ìœ  ì‹œ ì˜ìƒ ì‹œì²­ ë¹„ìœ¨ì´ í¬ê²Œ ì¦ê°€")
report.append(f"- ì‹ í˜¼ íƒ€ê²Ÿì˜ ê²½ìš° TV ë³´ìœ  ì‹œ **{tvì˜ìƒ_pct:.1f}%**ê°€ ì˜ìƒ ì‹œì²­")
report.append("")

# í—¤ë“œë³´ë“œ íƒ€ì… Ã— ë§Œì¡±ë„
report.append("### 4.2 í—¤ë“œë³´ë“œ íƒ€ì… Ã— ë§Œì¡±ë„ (ì‹ í˜¼ íƒ€ê²Ÿ)")
report.append("")
report.append("| í—¤ë“œë³´ë“œ íƒ€ì… | ë§Œì¡± | ë³´í†µ | ë¶ˆë§Œì¡± |")
report.append("|--------------|------|------|--------|")

if len(ì†Œí”„íŠ¸) > 0:
    ì†Œí”„íŠ¸_ë§Œì¡± = ì†Œí”„íŠ¸['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum() / len(ì†Œí”„íŠ¸) * 100
    ì†Œí”„íŠ¸_ë³´í†µ = (ì†Œí”„íŠ¸['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'] == 'ë³´í†µì´ë‹¤').sum() / len(ì†Œí”„íŠ¸) * 100
    ì†Œí”„íŠ¸_ë¶ˆë§Œ = ì†Œí”„íŠ¸['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ê·¸ë ‡ì§€ ì•Šë‹¤', 'ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤']).sum() / len(ì†Œí”„íŠ¸) * 100
    report.append(f"| ì†Œí”„íŠ¸ íƒ€ì… | **{ì†Œí”„íŠ¸_ë§Œì¡±:.1f}%** | {ì†Œí”„íŠ¸_ë³´í†µ:.1f}% | {ì†Œí”„íŠ¸_ë¶ˆë§Œ:.1f}% |")

if len(í•˜ë“œ) > 0:
    í•˜ë“œ_ë§Œì¡± = í•˜ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ë§¤ìš° ê·¸ë ‡ë‹¤', 'ì–´ëŠ ì •ë„ ê·¸ë ‡ë‹¤']).sum() / len(í•˜ë“œ) * 100
    í•˜ë“œ_ë³´í†µ = (í•˜ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'] == 'ë³´í†µì´ë‹¤').sum() / len(í•˜ë“œ) * 100
    í•˜ë“œ_ë¶ˆë§Œ = í•˜ë“œ['Q9_í—¤ë“œë³´ë“œí¸ì•ˆí•¨'].isin(['ê·¸ë ‡ì§€ ì•Šë‹¤', 'ì „í˜€ ê·¸ë ‡ì§€ ì•Šë‹¤']).sum() / len(í•˜ë“œ) * 100
    report.append(f"| í•˜ë“œ íƒ€ì… | {í•˜ë“œ_ë§Œì¡±:.1f}% | {í•˜ë“œ_ë³´í†µ:.1f}% | **{í•˜ë“œ_ë¶ˆë§Œ:.1f}%** |")

report.append("")
report.append("**ì¸ì‚¬ì´íŠ¸**:")
report.append(f"- ì†Œí”„íŠ¸ íƒ€ì…ì˜ ë§Œì¡±ë„ê°€ **{ì†Œí”„íŠ¸_ë§Œì¡±:.1f}%**ë¡œ í•˜ë“œ íƒ€ì…({í•˜ë“œ_ë§Œì¡±:.1f}%) ëŒ€ë¹„ **{ë§Œì¡±ë„_ë°°ìˆ˜:.1f}ë°°** ë†’ìŒ")
report.append("- **ê°€ì„¤ 2 ê²€ì¦**: âœ… \"íŒ¨ë¸Œë¦­ ì¹¨ëŒ€ ì„ í˜¸ë„ê°€ ë†’ë‹¤\" â†’ **ì…ì¦ë¨**")
report.append("")
report.append("---")
report.append("")

# ê²°ë¡ 
report.append("## 5. ê²°ë¡  ë° ì œì–¸")
report.append("")
report.append("### 5.1 í•µì‹¬ ì¸ì‚¬ì´íŠ¸")
report.append("")
report.append("1. **ì‹ í˜¼ íƒ€ê²Ÿì€ ì¹¨ëŒ€ë¥¼ ë‹¨ìˆœí•œ ìˆ˜ë©´ ê³µê°„ì´ ì•„ë‹Œ ìƒí™œ ê³µê°„ìœ¼ë¡œ í™œìš©**")
report.append(f"   - 82.1%ê°€ ì¹¨ëŒ€ì—ì„œ ì˜ìƒ ì‹œì²­")
report.append(f"   - 39.7%ê°€ 1ì‹œê°„ ì´ìƒ ì¥ì‹œê°„ ì‚¬ìš©")
report.append("")
report.append("2. **í—¤ë“œë³´ë“œ ì¤‘ìš”ë„ ì¸ì‹ì´ ë†’ìŒ**")
report.append(f"   - 91.6%ê°€ í—¤ë“œë³´ë“œë¥¼ ì¤‘ìš”í•˜ê²Œ ìƒê°")
report.append("   - í•˜ì§€ë§Œ í˜„ì¬ ë§Œì¡±ë„ëŠ” ë‚®ìŒ (37.2%)")
report.append("")
report.append("3. **ì†Œí”„íŠ¸ íƒ€ì… í—¤ë“œë³´ë“œì— ëŒ€í•œ ì„ í˜¸ë„ê°€ ë†’ìŒ**")
report.append(f"   - ì†Œí”„íŠ¸ íƒ€ì… ë§Œì¡±ë„ {ì†Œí”„íŠ¸_ë§Œì¡±:.1f}% vs í•˜ë“œ íƒ€ì… {í•˜ë“œ_ë§Œì¡±:.1f}%")
report.append(f"   - ì•½ {ë§Œì¡±ë„_ë°°ìˆ˜:.1f}ë°° ì°¨ì´")
report.append("")
report.append("### 5.2 ì œí’ˆ ê°œë°œ ì œì–¸")
report.append("")
report.append("1. **í¸ì•ˆí•œ ê¸°ëŒ€ê¸° ê²½í—˜ì— ì§‘ì¤‘**")
report.append("   - ë¨¸ë¦¬Â·ëª© ì§€ì§€ë ¥ ê°•í™”")
report.append("   - ê°ë„ ì¡°ì ˆ ê°€ëŠ¥í•œ ë””ìì¸")
report.append("   - ì¶©ë¶„í•œ ì¿ ì…˜ê° ì œê³µ")
report.append("")
report.append("2. **TV/OTT ì‹œì²­ì— ìµœì í™”ëœ ë””ìì¸**")
report.append("   - ì¥ì‹œê°„ ì‚¬ìš©ì—ë„ í¸ì•ˆí•œ êµ¬ì¡°")
report.append("   - ì‹œì²­ ê°ë„ë¥¼ ê³ ë ¤í•œ í—¤ë“œë³´ë“œ ë†’ì´/ê°ë„")
report.append("")
report.append("3. **ì‹ í˜¼ íƒ€ê²Ÿ ë§ì¶¤í˜• ë§ˆì¼€íŒ…**")
report.append("   - \"ì¹¨ëŒ€ì—ì„œì˜ ìƒˆë¡œìš´ ë¼ì´í”„ìŠ¤íƒ€ì¼\" ê°•ì¡°")
report.append("   - TV/OTT ì‹œì²­ ê²½í—˜ ì¤‘ì‹¬ì˜ ì œí’ˆ ì†Œêµ¬")
report.append("   - 2ì¸ ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ ê°•ì¡°")
report.append("")
report.append("---")
report.append("")
report.append(f"*ë¶„ì„ ê¸°ì¤€ì¼: 2026ë…„ 1ì›”*  ")
report.append(f"*ì´ ì‘ë‹µì: {len(group1)}ëª…*  ")
report.append(f"*ì‹ í˜¼ íƒ€ê²Ÿ ì •ì˜: ê²°í˜¼ 3ë…„ ì´ë‚´ (n={len(group3)})*")

# íŒŒì¼ ì €ì¥
with open(REPORT_FILE, 'w', encoding='utf-8') as f:
    f.write('\n'.join(report))

print(f"âœ“ ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ: {REPORT_FILE}")
print(f"  - ì‹ í˜¼ íƒ€ê²Ÿ: {len(group3)}ëª… (ê²°í˜¼ 3ë…„ ì´ë‚´)")
print(f"  - ì£¼ìš” ì§€í‘œ ëª¨ë‘ ì—…ë°ì´íŠ¸ë¨")

